import*as collections from"./collections.js";import*as storage from"./storage.js";import{escapeHtml}from"./utils.js";const COLLECTIONS_CONTAINER_ID="collections-container";export function init(){let e=document.getElementById("collections-container");e||(e=createCollectionsSection(),insertCollectionsSection(e)),renderCollections(),window.addEventListener("collectionsUpdated",renderCollections)}function createCollectionsSection(){const e=document.createElement("div");return e.id="collections-container",e.className="collections-section",e}function insertCollectionsSection(e){const t=document.querySelector("main");if(!t)return;const n=document.getElementById("guides-container");n?n.parentNode.insertBefore(e,n):t.insertBefore(e,t.lastChild)}function renderCollections(){const e=document.getElementById("collections-container");if(!e)return;const t=collections.getCollectionsSorted();if(e.innerHTML="",0===t.length){const t=document.createElement("div");return t.className="collections-empty",t.innerHTML="\n      <p>No collections yet. Create one by clicking üìå on any guide to get started!</p>\n    ",void e.appendChild(t)}const n=document.createElement("div");n.className="collections-header",n.innerHTML="<h2>üìö My Collections</h2>",e.appendChild(n);const o=document.createElement("div");o.className="collections-grid",t.forEach(e=>{const t=createCollectionCard(e);o.appendChild(t)}),e.appendChild(o)}function createCollectionCard(e){const t=document.createElement("div");t.className="collection-card",t.setAttribute("data-collection-id",e.id);const n=collections.getCollectionProgress(e.id),o=n.total>0?Math.round(n.read/n.total*100):0;let c="";c=n.total>0?`\n      <div class="collection-actions">\n        <button class="view-collection-btn" data-collection-id="${e.id}" title="View collection">üìñ View</button>\n        <button class="edit-collection-btn" data-collection-id="${e.id}" title="Edit collection">‚úèÔ∏è</button>\n        <button class="delete-collection-btn" data-collection-id="${e.id}" title="Delete collection">üóëÔ∏è</button>\n      </div>\n    `:`\n      <div class="collection-actions">\n        <button class="delete-collection-btn" data-collection-id="${e.id}" title="Delete collection">üóëÔ∏è Delete</button>\n      </div>\n    `,t.innerHTML=`\n    <div class="collection-header">\n      <span class="collection-icon">${e.icon}</span>\n      <h3 class="collection-name">${escapeHtml(e.name)}</h3>\n    </div>\n    <div class="collection-progress">\n      <div class="progress-bar">\n        <div class="progress-fill" style="width: ${o}%"></div>\n      </div>\n      <div class="progress-text">${n.read}/${n.total} guides read</div>\n    </div>\n    ${c}\n  `;const l=t.querySelector(".view-collection-btn");l&&l.addEventListener("click",()=>viewCollection(e.id));const i=t.querySelector(".edit-collection-btn");i&&i.addEventListener("click",()=>editCollection(e.id));const s=t.querySelector(".delete-collection-btn");return s&&s.addEventListener("click",()=>deleteCollection(e.id)),t}function viewCollection(e){const t=document.querySelector(`[data-collection-id="${e}"]`);if(t)if(t.classList.toggle("expanded")){const n=collections.getCollections()[e];if(!n)return;const o=document.createElement("div");if(o.className="collection-guides",0===n.guideIds.length)o.innerHTML="<p>No guides in this collection yet.</p>";else{const e=document.createElement("div");e.className="collection-guides-grid",n.guideIds.forEach(t=>{const n=document.querySelector(`.card[data-guide="${t}"]`);if(n){const t=n.cloneNode(!0);t.classList.add("collection-guide-item"),e.appendChild(t)}}),o.appendChild(e)}t.appendChild(o)}else{const e=t.querySelector(".collection-guides");e&&e.remove()}}function editCollection(e){const t=collections.getCollections()[e];if(!t)return;const n=prompt("Collection name:",t.name);n&&n.trim()&&(collections.updateCollection(e,{name:n.trim()}),renderCollections())}function deleteCollection(e){const t=collections.getCollections()[e];t&&confirm(`Delete collection "${t.name}"? This cannot be undone.`)&&(collections.deleteCollection(e),renderCollections())}