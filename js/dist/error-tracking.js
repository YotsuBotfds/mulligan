const MAX_ERRORS=50,STORAGE_KEY="compendium-error-log";let errorLog=[];export function init(){loadErrorsFromStorage(),window.onerror=handleError,window.onunhandledrejection=handleUnhandledRejection,"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("error",handleServiceWorkerError),console.log("Error tracking initialized")}function handleError(r,o,e,t,n){return addError({timestamp:(new Date).toISOString(),message:r||"Unknown error",source:o||"unknown",line:e||0,column:t||0,stack:n?.stack||"",type:"uncaughtError"}),!0}function handleUnhandledRejection(r){const o=r.reason||{},e=o.message||String(o),t=o.stack||"";addError({timestamp:(new Date).toISOString(),message:e,source:"Promise rejection",line:0,column:0,stack:t,type:"unhandledRejection"})}function handleServiceWorkerError(r){const o=r.message||"Service Worker error",e=r.stack||"";addError({timestamp:(new Date).toISOString(),message:o,source:"Service Worker",line:0,column:0,stack:e,type:"serviceWorkerError"})}function addError(r){errorLog.unshift(r),errorLog.length>50&&(errorLog=errorLog.slice(0,50)),saveErrorsToStorage(),console.error("[Error Tracker]",r)}function saveErrorsToStorage(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(errorLog))}catch(r){console.warn("Failed to save error log to localStorage:",r)}}function loadErrorsFromStorage(){try{const r=localStorage.getItem(STORAGE_KEY);r&&(errorLog=JSON.parse(r))}catch(r){console.warn("Failed to load error log from localStorage:",r),errorLog=[]}}export function getErrors(){return[...errorLog]}export function getErrorCount(){return errorLog.length}export function clearErrors(){errorLog=[];try{localStorage.removeItem(STORAGE_KEY)}catch(r){console.warn("Failed to clear error log from localStorage:",r)}}export function formatError(r){const o=new Date(r.timestamp),e=o.toLocaleTimeString();return`[${o.toLocaleDateString()} ${e}] ${r.type}\nMessage: ${r.message}\nSource: ${r.source} (${r.line}:${r.column})\n`+(r.stack?"Stack: "+r.stack:"")}export function exportErrorsAsText(){return`Error Log Export\nGenerated: ${(new Date).toISOString()}\nTotal Errors: ${errorLog.length}\n${"=".repeat(50)}\n\n`+errorLog.map(r=>formatError(r)).join("\n"+"-".repeat(50)+"\n\n")}