import*as errorTracking from"./error-tracking.js";import{escapeHtml}from"./utils.js";let debugClickTimeout,debugClickCount=0;export function init(){const e=document.querySelector("footer");e&&e.addEventListener("click",handleVersionClick)}function handleVersionClick(){debugClickCount++,clearTimeout(debugClickTimeout),debugClickTimeout=setTimeout(()=>{debugClickCount=0},1e3),debugClickCount>=3&&(debugClickCount=0,showDebugMenu())}function showDebugMenu(){const e=document.createElement("div");e.id="debug-menu",e.className="debug-menu",e.innerHTML='\n    <div class="debug-menu-content">\n      <h3>Debug Menu</h3>\n      <button id="view-errors-btn" class="debug-btn">View Error Log</button>\n      <button id="close-debug-btn" class="debug-btn debug-btn-secondary">Close</button>\n    </div>\n  ',document.body.appendChild(e),document.getElementById("view-errors-btn").addEventListener("click",showErrorModal),document.getElementById("close-debug-btn").addEventListener("click",()=>{e.remove()}),e.addEventListener("click",r=>{r.target===e&&e.remove()})}function showErrorModal(){const e=errorTracking.getErrors(),r=errorTracking.getErrorCount(),n=document.createElement("div");n.id="error-viewer-modal",n.className="error-viewer-modal",n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.setAttribute("aria-labelledby","error-viewer-title");let o="";o=0===e.length?'<p class="no-errors">No errors logged</p>':e.map((e,r)=>createErrorElement(e,r)).join(""),n.innerHTML=`\n    <div class="error-viewer-content">\n      <div class="error-viewer-header">\n        <h2 id="error-viewer-title">Error Log</h2>\n        <p class="error-count">${r} error${1!==r?"s":""} logged</p>\n      </div>\n\n      <div class="error-viewer-errors">\n        ${o}\n      </div>\n\n      <div class="error-viewer-actions">\n        <button id="copy-errors-btn" class="error-btn error-btn-primary" title="Copy errors to clipboard">\n          üìã Copy to Clipboard\n        </button>\n        <button id="clear-errors-btn" class="error-btn error-btn-danger" title="Clear all errors">\n          üóëÔ∏è Clear Errors\n        </button>\n        <button id="close-errors-btn" class="error-btn error-btn-secondary" title="Close error viewer">\n          Close\n        </button>\n      </div>\n    </div>\n  `,document.body.appendChild(n),document.getElementById("copy-errors-btn").addEventListener("click",copyErrorsToClipboard),document.getElementById("clear-errors-btn").addEventListener("click",()=>{confirm("Are you sure you want to clear all errors?")&&(errorTracking.clearErrors(),n.remove(),showErrorModal())}),document.getElementById("close-errors-btn").addEventListener("click",()=>{n.remove()}),n.addEventListener("click",e=>{e.target===n&&n.remove()});const t=e=>{"Escape"===e.key&&(n.remove(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t)}function createErrorElement(e,r){const n=new Date(e.timestamp),o=n.toLocaleTimeString(),t=n.toLocaleDateString(),s=e.stack?`<pre class="error-stack">${escapeHtml(e.stack)}</pre>`:"";return`\n    <details class="error-entry">\n      <summary class="error-summary">\n        <span class="error-index">#${r+1}</span>\n        <span class="error-type">${escapeHtml(e.type)}</span>\n        <span class="error-message">${escapeHtml(e.message.substring(0,50))}${e.message.length>50?"...":""}</span>\n        <span class="error-time">${o}</span>\n      </summary>\n      <div class="error-details">\n        <div class="error-field">\n          <span class="error-label">Time:</span>\n          <span class="error-value">${t} ${o}</span>\n        </div>\n        <div class="error-field">\n          <span class="error-label">Type:</span>\n          <span class="error-value">${escapeHtml(e.type)}</span>\n        </div>\n        <div class="error-field">\n          <span class="error-label">Message:</span>\n          <span class="error-value">${escapeHtml(e.message)}</span>\n        </div>\n        <div class="error-field">\n          <span class="error-label">Source:</span>\n          <span class="error-value">${escapeHtml(e.source)} (${e.line}:${e.column})</span>\n        </div>\n        ${s}\n      </div>\n    </details>\n  `}function copyErrorsToClipboard(){const e=errorTracking.exportErrorsAsText();navigator.clipboard.writeText(e).then(()=>{const e=document.getElementById("copy-errors-btn"),r=e.textContent;e.textContent="‚úÖ Copied!",setTimeout(()=>{e.textContent=r},2e3)}).catch(e=>{console.error("Failed to copy to clipboard:",e),alert("Failed to copy errors to clipboard")})}export function openErrorViewer(){showErrorModal()}