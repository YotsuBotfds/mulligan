import*as storage from"./storage.js";const STORAGE_KEY="compendium-recently-viewed",MAX_VIEWS=10,DISPLAY_COUNT=5;export function trackView(e,t,n,r){const i=getRecentViews().filter(t=>t.guideId!==e),c=[{guideId:e,title:t,icon:n,href:r||null,timestamp:Date.now()},...i].slice(0,10);storage.set(STORAGE_KEY,c)}export function getRecentViews(){return storage.get(STORAGE_KEY,[])}function formatTimeAgo(e){const t=Date.now()-e,n=Math.floor(t/1e3),r=Math.floor(n/60),i=Math.floor(r/60),c=Math.floor(i/24);return c>0?1===c?"yesterday":`${c}d ago`:i>0?1===i?"1h ago":`${i}h ago`:r>0?1===r?"1m ago":`${r}m ago`:"just now"}function createRecentCard(e){const t=document.createElement("a");t.className="recent-card",t.href=e.href||`guides/${e.guideId}.html`,t.setAttribute("data-guide",e.guideId);const n=formatTimeAgo(e.timestamp);return t.innerHTML=`\n    <span class="recent-icon">${e.icon}</span>\n    <div class="recent-info">\n      <h4>${e.title}</h4>\n      <span class="time-ago">Last viewed ${n}</span>\n    </div>\n  `,t}function renderRecentlyViewed(){const e=getRecentViews().slice(0,5);let t=document.getElementById("recently-viewed-section");if(0===e.length)return void(t&&(t.style.display="none"));if(!t){const e=document.getElementById("guides-container");if(!e)return;t=document.createElement("section"),t.id="recently-viewed-section",t.className="recently-viewed",e.insertAdjacentElement("beforebegin",t)}t.innerHTML='\n    <h2 class="section-heading">ðŸ“– Continue Learning</h2>\n    <div class="recent-cards"></div>\n  ';const n=t.querySelector(".recent-cards");for(const t of e){const e=createRecentCard(t);n.appendChild(e)}t.style.display="block"}export function init(){renderRecentlyViewed(),document.addEventListener("click",e=>{const t=e.target.closest(".card[data-guide]");t&&(trackView(t.getAttribute("data-guide"),t.querySelector("h3")?.textContent||"Guide",t.querySelector(".icon")?.textContent||"ðŸ“„",t.getAttribute("href")),renderRecentlyViewed())}),window.addEventListener("cardsRerendered",()=>{renderRecentlyViewed()})}