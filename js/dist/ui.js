import*as storage from"./storage.js";import*as practiceMode from"./practice-mode.js";export function initializeThemeToggle(){const e=document.getElementById("theme-toggle");if(!e)return;const t=storage.getTheme();document.documentElement.setAttribute("data-theme",t),e.textContent="dark"===t?"â˜€ï¸":"ðŸŒ™",e.addEventListener("click",()=>{const t="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.documentElement.setAttribute("data-theme",t),storage.setTheme(t),e.textContent="dark"===t?"â˜€ï¸":"ðŸŒ™"})}export function initializeFilters(){const e=document.querySelectorAll(".filter-btn");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>e.classList.remove("active")),t.classList.add("active");const n=t.getAttribute("data-filter"),i=document.querySelectorAll(".card[data-guide]"),o=storage.getProgress();i.forEach(e=>{const t=e.getAttribute("data-tags")||"",i=e.getAttribute("data-guide"),a=e.getAttribute("data-category")||"",l=e.getAttribute("data-difficulty")||"",c=o[i]?.completed,s=practiceMode.getPracticeStatus(i),d=!0===s?.practiced;let r=!0;"all"===n?r=!0:"critical"===n?r=t.includes("critical"):"essential"===n?r=t.includes("essential"):"rebuild"===n?r=t.includes("rebuild"):"new"===n?r=t.includes("new"):"unread"===n?r=!c:"completed"===n?r=c:"practiced"===n?r=d:"unpracticed"===n?r=!d:"beginner"===n?r="beginner"===l:"intermediate"===n?r="intermediate"===l:"advanced"===n?r="advanced"===l:"tools"===n&&(r="tools"===a),e.style.display=r?"":"none"}),updateSectionHeadingVisibility();const a=document.getElementById("guides-container");if(a){const e=document.querySelectorAll('.card[data-guide]:not([style*="display: none"])').length;a.setAttribute("aria-live","polite"),a.setAttribute("aria-label",`Showing ${e} guides filtered by ${n}`)}}),t.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})})}function updateSectionHeadingVisibility(){const e=document.getElementById("guides-container");if(!e)return;const t=Array.from(e.children);let n=null,i=null;for(const e of t)if(e.classList.contains("section-heading")||"H2"===e.tagName){if(n&&i){const e=i.querySelectorAll('.card:not([style*="display: none"])');n.style.display=e.length>0?"":"none",i.style.display=e.length>0?"":"none"}n=e,i=null}else e.classList.contains("card-section")?i=e:e.classList.contains("card")&&(i||"none"!==e.style.display&&n&&(n.style.display=""));if(n&&i){const e=i.querySelectorAll('.card:not([style*="display: none"])');n.style.display=e.length>0?"":"none",i.style.display=e.length>0?"":"none"}const o=e.querySelector(".whats-new-section");if(o){const e=document.querySelector(".filter-btn.active"),t=e?e.getAttribute("data-filter"):"all";o.style.display="all"===t?"":"none"}}export function initializeBackToTop(){const e=document.getElementById("back-to-top");e&&(window.addEventListener("scroll",()=>{e.style.display=window.scrollY>400?"block":"none"}),e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}export function updateProgressDisplay(e){const t=storage.getProgress();let n=0;e.forEach(e=>{const i=e.getAttribute("data-guide"),o=e.querySelector(".read-check");t[i]&&t[i].completed&&(o&&o.classList.add("done"),n++)});const i=document.getElementById("progress-count"),o=document.getElementById("total-guides");i&&(i.textContent=n),o&&(o.textContent=e.length)}