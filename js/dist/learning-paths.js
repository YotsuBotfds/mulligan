import*as storage from"./storage.js";let learningPaths=[],guides=[];async function fetchLearningPaths(){try{const e=await fetch("data/learning-paths.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);learningPaths=await e.json()}catch(e){return console.error("Failed to fetch learning paths:",e),!1}return!0}async function fetchGuides(){try{const e=await fetch("data/guides.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);guides=await e.json()}catch(e){return console.error("Failed to fetch guides:",e),!1}return!0}function getGuideInfo(e){return guides.find(t=>t.id===e)||null}function getPathProgress(e){const t=learningPaths.find(t=>t.id===e);if(!t)return{completed:0,total:0,percentage:0};const n=storage.getCompletedGuides(),a=t.guides.filter(e=>n.has(e)).length,s=t.guides.length;return{completed:a,total:s,percentage:s>0?Math.round(a/s*100):0}}function getAllPathsWithProgress(){return learningPaths.map(e=>({...e,progress:getPathProgress(e.id)}))}function getRecommendedPath(){const e=learningPaths.find(e=>"survival-basics"===e.id);return e?{...e,progress:getPathProgress("survival-basics")}:null}function getPathGuides(e){const t=learningPaths.find(t=>t.id===e);if(!t)return[];const n=storage.getCompletedGuides();return t.guides.map((e,t)=>({...getGuideInfo(e),isCompleted:n.has(e),sequenceNumber:t+1}))}function createPathCardHTML(e){const t=getPathProgress(e.id);return`\n    <div class="learning-path-card" data-path-id="${e.id}">\n      <div class="path-header">\n        <div class="path-icon-title">\n          <span class="path-icon">${e.icon}</span>\n          <h3 class="path-name">${e.name}</h3>\n        </div>\n        ${{beginner:'<span class="difficulty-badge difficulty-beginner">Beginner</span>',intermediate:'<span class="difficulty-badge difficulty-intermediate">Intermediate</span>',advanced:'<span class="difficulty-badge difficulty-advanced">Advanced</span>'}[e.difficulty]||""}\n      </div>\n\n      <p class="path-description">${e.description}</p>\n\n      <div class="path-metadata">\n        <span class="path-info">\n          <span class="info-label">Guides:</span>\n          <span class="info-value">${e.guides.length}</span>\n        </span>\n        <span class="path-info">\n          <span class="info-label">Time:</span>\n          <span class="info-value">~${e.estimatedHours}h</span>\n        </span>\n      </div>\n\n      <div class="path-progress">\n        <div class="progress-bar-container">\n          <div class="progress-bar" style="width: ${t.percentage}%"></div>\n        </div>\n        <p class="progress-text">\n          ${t.completed} of ${t.total} guides completed\n          <span class="progress-percentage">${t.percentage}%</span>\n        </p>\n      </div>\n\n      <button class="btn-view-path" data-path-id="${e.id}">\n        View Path ‚Üí\n      </button>\n    </div>\n  `}function createPathDetailsHTML(e){const t=learningPaths.find(t=>t.id===e);if(!t)return"<p>Path not found</p>";const n=getPathGuides(e),a=getPathProgress(e),s=n.map(e=>`\n    <div class="path-guide-item ${e.isCompleted?"completed":""}">\n      <span class="guide-sequence">${e.sequenceNumber}</span>\n      <span class="guide-icon">${e.icon||"üìñ"}</span>\n      <div class="guide-info">\n        <h4 class="guide-title">${e.title}</h4>\n        <p class="guide-meta">\n          <span class="reading-time">${e.readingTime}h</span>\n          <span class="difficulty difficulty-${e.difficulty}">${e.difficulty}</span>\n        </p>\n      </div>\n      ${e.isCompleted?'<span class="checkmark">‚úì</span>':""}\n      <a href="${e.url}" class="guide-link" data-guide-id="${e.id}">Read ‚Üí</a>\n    </div>\n  `).join("");return`\n    <div class="path-details">\n      <div class="details-header">\n        <button class="btn-back" id="btn-back-to-paths">‚Üê Back to Paths</button>\n        <h2>${t.icon} ${t.name}</h2>\n      </div>\n\n      <div class="details-info">\n        <p>${t.description}</p>\n        <div class="path-stats">\n          <div class="stat">\n            <span class="stat-label">Total Guides</span>\n            <span class="stat-value">${t.guides.length}</span>\n          </div>\n          <div class="stat">\n            <span class="stat-label">Completed</span>\n            <span class="stat-value">${a.completed}</span>\n          </div>\n          <div class="stat">\n            <span class="stat-label">Est. Time</span>\n            <span class="stat-value">~${t.estimatedHours}h</span>\n          </div>\n          <div class="stat">\n            <span class="stat-label">Progress</span>\n            <span class="stat-value">${a.percentage}%</span>\n          </div>\n        </div>\n\n        <div class="path-progress">\n          <div class="progress-bar-container">\n            <div class="progress-bar" style="width: ${a.percentage}%"></div>\n          </div>\n          <p class="progress-text">\n            ${a.completed} of ${a.total} guides completed\n          </p>\n        </div>\n      </div>\n\n      <div class="guides-list">\n        <h3>Learning Sequence</h3>\n        ${s}\n      </div>\n    </div>\n  `}function renderLearningPathsSection(){let e=document.getElementById("learning-paths-container");if(!e){const t=document.querySelector("main")||document.body;e=document.createElement("section"),e.id="learning-paths-container",e.className="learning-paths-section",t.insertBefore(e,t.firstChild)}const t=getAllPathsWithProgress(),n=getRecommendedPath();let a='\n    <div class="learning-paths-wrapper">\n      <h2 class="section-title">Learning Paths</h2>\n      <p class="section-subtitle">Choose a structured path to build your survival and self-sufficiency skills</p>\n  ';n&&(a+=`\n      <div class="start-here-recommendation">\n        <div class="recommendation-badge">Recommended for Beginners</div>\n        <h3 class="recommendation-title">\n          <span class="icon">üëã</span>\n          Start Here: ${n.name}\n        </h3>\n        <p class="recommendation-description">${n.description}</p>\n        <button class="btn-start-path" data-path-id="${n.id}">\n          Start ${n.name} ‚Üí\n        </button>\n      </div>\n    `),a+='<div class="learning-paths-grid">',t.forEach(e=>{a+=createPathCardHTML(e)}),a+="</div></div>",e.innerHTML=a,attachEventListeners()}function showPathDetails(e){let t=document.getElementById("learning-path-details");t||(t=document.createElement("div"),t.id="learning-path-details",t.className="learning-path-details-container",document.body.appendChild(t)),t.innerHTML=createPathDetailsHTML(e),t.classList.add("active");const n=document.getElementById("learning-paths-container");n&&(n.style.display="none");const a=document.getElementById("btn-back-to-paths");a&&a.addEventListener("click",hidePathDetails),t.querySelectorAll(".guide-link").forEach(t=>{t.addEventListener("click",n=>{const a=t.dataset.guideId;a&&(storage.addCompletedGuide(a),renderLearningPathsSection(),showPathDetails(e))})}),window.scrollTo({top:0,behavior:"smooth"})}function hidePathDetails(){const e=document.getElementById("learning-path-details");e&&e.classList.remove("active");const t=document.getElementById("learning-paths-container");t&&(t.style.display=""),window.scrollTo({top:0,behavior:"smooth"})}function attachEventListeners(){document.querySelectorAll(".btn-view-path").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.pathId;t&&showPathDetails(t)})}),document.querySelectorAll(".btn-start-path").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.pathId;t&&showPathDetails(t)})}),document.querySelectorAll(".learning-path-card").forEach(e=>{e.addEventListener("click",t=>{if("BUTTON"!==t.target.tagName){const t=e.dataset.pathId;t&&showPathDetails(t)}})})}async function init(){try{const e=await fetchLearningPaths(),t=await fetchGuides();return e&&t?("loading"===document.readyState?document.addEventListener("DOMContentLoaded",renderLearningPathsSection):renderLearningPathsSection(),console.log("Learning Paths module initialized"),!0):(console.error("Failed to initialize learning paths"),!1)}catch(e){return console.error("Error initializing learning paths:",e),!1}}export{init,getAllPathsWithProgress,getPathProgress,getRecommendedPath,getPathGuides,showPathDetails,hidePathDetails,renderLearningPathsSection};