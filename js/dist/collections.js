import*as storage from"./storage.js";const COLLECTIONS_KEY="compendium-collections",COLLECTION_ORDER_KEY="compendium-collection-order";export function getCollections(){return storage.get(COLLECTIONS_KEY,{})}function getCollectionOrder(){return storage.get(COLLECTION_ORDER_KEY,[])}function saveCollectionOrder(e){storage.set(COLLECTION_ORDER_KEY,e)}function generateId(){return`col-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}export function createCollection(e,t="ðŸ“š"){if(!e||""===e.trim())throw new Error("Collection name is required");const o=getCollections(),r=generateId(),n=(new Date).toISOString(),i={id:r,name:e.trim(),icon:t,guideIds:[],createdAt:n,updatedAt:n};o[r]=i,storage.set(COLLECTIONS_KEY,o);const l=getCollectionOrder();return l.push(r),saveCollectionOrder(l),i}export function deleteCollection(e){const t=getCollections();return!!t[e]&&(delete t[e],storage.set(COLLECTIONS_KEY,t),saveCollectionOrder(getCollectionOrder().filter(t=>t!==e)),!0)}export function updateCollection(e,t){const o=getCollections(),r=o[e];return r?(t.name&&(r.name=t.name.trim()),t.icon&&(r.icon=t.icon),r.updatedAt=(new Date).toISOString(),storage.set(COLLECTIONS_KEY,o),r):null}export function addToCollection(e,t){const o=getCollections(),r=o[e];return!!r&&(r.guideIds.includes(t)||(r.guideIds.push(t),r.updatedAt=(new Date).toISOString(),storage.set(COLLECTIONS_KEY,o)),!0)}export function removeFromCollection(e,t){const o=getCollections(),r=o[e];if(!r)return!1;const n=r.guideIds.indexOf(t);return n>-1&&(r.guideIds.splice(n,1),r.updatedAt=(new Date).toISOString(),storage.set(COLLECTIONS_KEY,o),!0)}export function isGuideInCollection(e,t){const o=getCollections()[e];return!!o&&o.guideIds.includes(t)}export function getCollectionGuides(e){const t=getCollections()[e];return t&&t.guideIds||[]}export function getCollectionProgress(e){const t=getCollections()[e];if(!t)return{total:0,read:0};const o=storage.get("compendium-progress",{}),r=t.guideIds.filter(e=>o[e]?.completed).length;return{total:t.guideIds.length,read:r}}export function getCollectionsSorted(){const e=getCollections();return getCollectionOrder().map(t=>e[t]).filter(e=>e)}export function exportCollections(){return{collections:getCollections(),order:getCollectionOrder()}}export function importCollections(e){try{return!(!e.collections||"object"!=typeof e.collections||(storage.set(COLLECTIONS_KEY,e.collections),e.order&&Array.isArray(e.order)&&saveCollectionOrder(e.order),0))}catch(e){return console.error("Error importing collections:",e),!1}}export function clearCollections(){storage.remove(COLLECTIONS_KEY),storage.remove(COLLECTION_ORDER_KEY)}